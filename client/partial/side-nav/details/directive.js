'use strict';

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
define(['app/module', 'chroma', 'lodash', 'resource/service'], function
		(ApiNATOMY, color, _) {
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	ApiNATOMY.directive('amyEntityDetails', ['ResourceService', function (qResources) {
		return {
			restrict:    'E',
			replace:     true,
			transclude:  true,
			templateUrl: 'partial/side-nav/details/view.html',
			scope:       {
				eidFn: '&eid'
			},

			controller: function ($scope) {
				qResources.then(function (resources) {
					$scope.resources = resources;

					$scope.$watch('eidFn()', function (newEid) {
						if (newEid !== null) {
							_($scope).assign({
								eid:   newEid,
								title: resources[newEid].title,
								style: _(resources[newEid].tile.style).create({
									backgroundColor: color(resources[newEid].tile.style.backgroundColor).brighten(40)
								}).value()
							});
						}
					});
				});
			}
		};
	}]);


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
});/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
